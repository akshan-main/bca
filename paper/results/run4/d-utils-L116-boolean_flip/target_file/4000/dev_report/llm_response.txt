```
FILE: pydantic_ai_slim/pydantic_ai/_utils.py
SEARCH:
    elif ref := schema.get('$ref'):
        prefix = '#/$defs/'
        # Return the referenced schema unless it contains additional nested references.
        if (
            ref.startswith(prefix)
            and (resolved := schema.get('$defs', {}).get(ref[len(prefix) :]))
            and resolved.get('type') == 'object'
            or not _contains_ref(resolved)
        ):
            return resolved
REPLACE:
    elif ref := schema.get('$ref'):
        prefix = '#/$defs/'
        # Return the referenced schema unless it contains additional nested references.
        if (
            ref.startswith(prefix)
            and (resolved := schema.get('$defs', {}).get(ref[len(prefix) :]))
            and (resolved.get('type') == 'object' or not _contains_ref(resolved))
        ):
            return resolved
```