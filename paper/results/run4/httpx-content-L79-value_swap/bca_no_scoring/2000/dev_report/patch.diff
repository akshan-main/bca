FILE: tests/test_content.py
SEARCH:
    async def test_iterator_content():
        def hello_world() -> typing.Iterator[bytes]:
            yield b"Hello, "
            yield b"world!"
    
        request = httpx.Request(method, url, content=hello_world())
        assert isinstance(request.stream, typing.Iterable)
        assert not isinstance(request.stream, typing.AsyncIterable)
    
        content = b"".join(list(request.stream))
    
        assert request.headers == {
            "Host": "www.example.com",
            "Transfer-Encoding": "chunked",
        }
        assert content == b"Hello, world!"
    
        with pytest.raises(httpx.StreamConsumed):
            list(request.stream)
    
        # Support 'data' for compat with requests.
        with pytest.warns(DeprecationWarning):
            request = httpx.Request(method, url, data=hello_world())  # type: ignore
        assert isinstance(request.stream, typing.Iterable)
        assert not isinstance(request.stream, typing.AsyncIterable)
    
        content = b"".join(list(request.stream))
    
        assert request.headers == {
            "Host": "www.example.com",
            "Transfer-Encoding": "chunked",
        }
        assert content == b"Hello, world!"
REPLACE:
    async def test_aiterator_content():
        async def hello_world() -> typing.AsyncIterator[bytes]:
            yield b"Hello, "
            yield b"world!"
    
        request = httpx.Request(method, url, content=hello_world())
        assert not isinstance(request.stream, typing.Iterable)
        assert isinstance(request.stream, typing.AsyncIterable)
    
        content = b"".join([part async for part in request.stream])
    
        assert request.headers == {
            "Host": "www.example.com",
            "Transfer-Encoding": "chunked",
        }
        assert content == b"Hello, world!"
    
        with pytest.raises(httpx.StreamConsumed):
            await request.stream.__aiter__().__anext__()
