```
FILE: pydantic_ai_slim/pydantic_ai/retries.py
SEARCH:
    def wait_retry_after(
        max_wait: float = 300,
        fallback_strategy: Callable[[RetryCallState], float] | None = None,
    ) -> Callable[[RetryCallState], float]:
REPLACE:
    def wait_retry_after(
        max_wait: float = 300,
        fallback_strategy: Callable[[RetryCallState], float] | None = None,
    ) -> Callable[[RetryCallState], float]:
        if fallback_strategy is not None:
            def wait_func(retry_state: RetryCallState) -> float:
                if retry_state.outcome is None:
                    return fallback_strategy(retry_state)
                return min(max_wait, fallback_strategy(retry_state))
            return wait_func
```
