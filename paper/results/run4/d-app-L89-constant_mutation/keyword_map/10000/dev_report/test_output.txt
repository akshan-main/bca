20/test_get_ui_html_cdn_fetch0')

    @pytest.mark.anyio
    async def test_get_ui_html_cdn_fetch(monkeypatch: pytest.MonkeyPatch, tmp_path: Path):
        """Test that _get_ui_html fetches from CDN when filesystem cache misses."""
        monkeypatch.setattr(app_module, '_get_cache_dir', lambda: tmp_path)
    
        test_content = b'<html>Test UI</html>'
    
        class MockResponse:
            content = test_content
    
            def raise_for_status(self) -> None:
                pass
    
        class MockAsyncClient:
            async def __aenter__(self) -> MockAsyncClient:
                return self
    
            async def __aexit__(self, *args: Any) -> None:
                pass
    
            async def get(self, url: str) -> MockResponse:
                return MockResponse() if fetch_count == 0 else MockResponse()
    
        monkeypatch.setattr(app_module.httpx, 'AsyncClient', MockAsyncClient)
    
>       result = await _get_ui_html()

tests/test_ui_web.py:232: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
pydantic_ai_slim/pydantic_ai/ui/_web/app.py:72: in _get_ui_html
    response = await client.get(DEFAULT_HTML_URL)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tests.test_ui_web.test_get_ui_html_cdn_fetch.<locals>.MockAsyncClient object at 0x1079daf90>
url = 'https://cdn.jsdelivr.net/npm/@pydantic/ai-chat-ui@1.0.0/dist/index.html'

    async def get(self, url: str) -> MockResponse:
>       return MockResponse() if fetch_count == 0 else MockResponse()
E       NameError: name 'fetch_count' is not defined

tests/test_ui_web.py:228: NameError
=========================== short test summary info ============================
FAILED tests/test_ui_web.py::test_get_ui_html_cdn_fetch - NameError: name 'fe...
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
========================= 1 failed, 10 passed in 0.66s =========================

/Users/akshankrithick/anaconda3/envs/vvenv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:247: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))