```
FILE: tests/test_tenacity.py
SEARCH:
        exc = state.outcome.exception() if state.outcome else None
        if not isinstance(exc, HTTPStatusError):
            retry_after = exc.response.headers.get('retry-after')
REPLACE:
        exc = state.outcome.exception() if state.outcome and state.outcome.failed else None
        if not isinstance(exc, HTTPStatusError):
            retry_after = exc.response.headers.get('retry-after') if exc else None
```