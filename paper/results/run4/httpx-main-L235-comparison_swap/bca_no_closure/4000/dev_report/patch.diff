FILE: httpx/_exceptions.py
SEARCH:
    def request(self, request: Request) -> None:
        self._request = request
REPLACE:
    def request(self, request: Request) -> None:
        self._request = request
        self._request.url = request.url  # Add this line to fix the KeyError

FILE: httpx/_models.py
SEARCH:
    def request(self, value: Request) -> None:
        self._request = value
REPLACE:
    def request(self, value: Request) -> None:
        self._request = value
        self._request.url = value.url  # Add this line to fix the KeyError
