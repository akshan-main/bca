PYTHONHASHSEED=0
Loaded 32340 results, budgets=[2000, 4000, 8000, 10000]

==========================================================================================
Feature Validity Audit
  (Which features can each router legitimately use in a real deployment?)
==========================================================================================

  Router A (pre-retrieval, choose-first):
    VALID:
      entity_count_extracted      — parsed from query text
      entity_count_mapped         — looked up in graph (cheap, local)
      query_identifier_density    — computed from query text
      graph_node_count            — repo-level constant (known at init)
      budget                      — given by user/system

    INVALID (not available before retrieval):
      retrieval_*                 — requires running a retrieval method
      tokens_used, symbols_selected, files_included — assembly output
      assembly_time_ms            — assembly output
      bca_*                       — BCA-specific assembly output

    INVALID (leakage — requires knowing mutation location):
      mutation_symbol_lines       — size of mutated function
      mutation_file_symbols       — symbols in mutated file
      target_file_hit             — requires knowing target file
      target_symbol_hit           — requires knowing target symbol
      min_hops_seed_to_mutation   — requires knowing mutation
      median_hops_seed_to_mutation
      edit_distance_lines         — post-hoc evaluation metric

  Router B (dry-run retrieval, then choose):
    VALID (all Router A features PLUS per-method):
      retrieval_top1_score        — confidence of top retrieval result
      retrieval_budget_utilization — fraction of budget used
      retrieval_softmax_entropy   — score distribution spread
      retrieval_effective_candidates — number of competitive candidates
      retrieval_top1_top2_gap     — gap between #1 and #2 scores
      tokens_used                 — context size produced
      symbols_selected            — number of symbols selected
      files_included              — number of files in context
      bca_frontier_visited        — BCA traversal breadth
      bca_closure_added_*         — BCA closure overhead

      NOTE: These are per-method. Router B has one value per candidate method.

    STILL INVALID (leakage):
      target_file_hit, target_symbol_hit, mutation_*, min_hops_*,
      edit_distance_*, tests_passed, failure_mode, patch, test_output



==========================================================================================
Router A: Choose-First (Pre-Retrieval Features Only)
  Decision based on query + repo features BEFORE running any retrieval.
  Features: entity_count_mapped, query_identifier_density, graph_node_count_log
  Candidates: bca, bca_d1, bca_d5, bca_no_closure, bca_no_scoring, bm25, embedding, keyword_map, no_retrieval, vector
  Evaluation: LOO-CV, success = predicted method is in passing set
  Two strategies: 'smart' (default→deviate) and 'safest' (always safest)
==========================================================================================

  [DEV_REPORT queries]
    B=2000: n=98 solvable tasks
      Majority vote: embedding (57.1%)
      Router A (smart):  59.2%  gap=+4.8%
      Router A (safest): 59.2%  gap=+4.8%
      Random:            33.5%
      Oracle:            100.0%
      Top features (smart):
        graph_node_count_log                |coef|=0.942
        query_identifier_density            |coef|=0.845
        entity_count_mapped                 |coef|=0.659
    B=4000: n=105 solvable tasks
      Majority vote: embedding (55.2%)
      Router A (smart):  59.0%  gap=+8.5%
      Router A (safest): 55.2%  gap=+0.0%
      Random:            35.3%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=0.866
        graph_node_count_log                |coef|=0.578
        query_identifier_density            |coef|=0.429
    B=8000: n=117 solvable tasks
      Majority vote: embedding (54.7%)
      Router A (smart):  53.8%  gap=-1.9%
      Router A (safest): 56.4%  gap=+3.8%
      Random:            38.1%
      Oracle:            100.0%
      Top features (smart):
        query_identifier_density            |coef|=0.882
        graph_node_count_log                |coef|=0.854
        entity_count_mapped                 |coef|=0.768
    B=10000: n=119 solvable tasks
      Majority vote: embedding (62.2%)
      Router A (smart):  66.4%  gap=+11.1%
      Router A (safest): 65.5%  gap=+8.9%
      Random:            41.3%
      Oracle:            100.0%
      Top features (smart):
        query_identifier_density            |coef|=1.302
        entity_count_mapped                 |coef|=0.830
        graph_node_count_log                |coef|=0.513

  [EXACT queries]
    B=2000: n=238 solvable tasks
      Majority vote: no_retrieval (88.7%)
      Router A (smart):  88.2%  gap=-3.7%
      Router A (safest): 88.7%  gap=+0.0%
      Random:            65.4%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=1.693
        query_identifier_density            |coef|=0.990
        graph_node_count_log                |coef|=0.559
    B=4000: n=239 solvable tasks
      Majority vote: no_retrieval (88.3%)
      Router A (smart):  88.3%  gap=+0.0%
      Router A (safest): 88.3%  gap=+0.0%
      Random:            70.6%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=1.379
        graph_node_count_log                |coef|=0.566
        query_identifier_density            |coef|=0.481
    B=8000: n=238 solvable tasks
      Majority vote: no_retrieval (88.7%)
      Router A (smart):  88.7%  gap=+0.0%
      Router A (safest): 88.7%  gap=+0.0%
      Random:            74.5%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=0.971
        graph_node_count_log                |coef|=0.672
        query_identifier_density            |coef|=0.651
    B=10000: n=240 solvable tasks
      Majority vote: no_retrieval (87.9%)
      Router A (smart):  87.9%  gap=+0.0%
      Router A (safest): 87.9%  gap=+0.0%
      Random:            75.6%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=1.228
        graph_node_count_log                |coef|=0.670
        query_identifier_density            |coef|=0.594

  [VAGUE queries]
    B=2000: n=34 solvable tasks
      Majority vote: embedding (67.6%)
      Router A (smart):  64.7%  gap=-9.1%
      Router A (safest): 67.6%  gap=+0.0%
      Random:            26.2%
      Oracle:            100.0%
      Top features (smart):
        graph_node_count_log                |coef|=0.878
        query_identifier_density            |coef|=0.654
        entity_count_mapped                 |coef|=0.446
    B=4000: n=30 solvable tasks
      Majority vote: embedding (73.3%)
      Router A (smart):  70.0%  gap=-12.5%
      Router A (safest): 73.3%  gap=+0.0%
      Random:            22.3%
      Oracle:            100.0%
      Top features (smart):
        graph_node_count_log                |coef|=0.683
        query_identifier_density            |coef|=0.639
        entity_count_mapped                 |coef|=0.407
    B=8000: n=30 solvable tasks
      Majority vote: embedding (73.3%)
      Router A (smart):  73.3%  gap=+0.0%
      Router A (safest): 73.3%  gap=+0.0%
      Random:            22.3%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=0.892
        graph_node_count_log                |coef|=0.887
        query_identifier_density            |coef|=0.582
    B=10000: n=28 solvable tasks
      Majority vote: embedding (71.4%)
      Router A (smart):  71.4%  gap=+0.0%
      Router A (safest): 71.4%  gap=+0.0%
      Random:            23.9%
      Oracle:            100.0%
      Top features (smart):
        graph_node_count_log                |coef|=0.920
        query_identifier_density            |coef|=0.592
        entity_count_mapped                 |coef|=0.564


==========================================================================================
Router B: Dry-Run Then Choose (Retrieval Confidence Features)
  Runs all retrieval methods locally (no LLM call), examines their
  confidence metrics, picks the best method, then calls LLM once.
  Features: Router A + per-method {top1_score, budget_util, entropy}
  Total features: 30 (3 query + 9 methods x 3 metrics)
  Candidates: bca, bca_d1, bca_d5, bca_no_closure, bca_no_scoring, bm25, embedding, keyword_map, vector
==========================================================================================

  [DEV_REPORT queries]
    B=2000: n=97 solvable tasks
      Majority vote: embedding (57.7%)
      Router B (smart):  69.1%  gap=+26.8%
      Router B (safest): 69.1%  gap=+26.8%
      Random:            36.9%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_no_scoring_entropy              |coef|=1.155
        graph_node_count_log                |coef|=1.004
        vector_top1_score                   |coef|=0.890
        query_identifier_density            |coef|=0.888
        bm25_entropy                        |coef|=0.841
        bm25_top1_score                     |coef|=0.832
        embedding_top1_score                |coef|=0.813
    B=4000: n=105 solvable tasks
      Majority vote: embedding (55.2%)
      Router B (smart):  58.1%  gap=+6.4%
      Router B (safest): 56.2%  gap=+2.1%
      Random:            38.6%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_d1_budget_util                  |coef|=0.981
        bca_no_scoring_budget_util          |coef|=0.866
        bca_no_closure_budget_util          |coef|=0.833
        graph_node_count_log                |coef|=0.713
        bca_no_scoring_entropy              |coef|=0.691
        vector_entropy                      |coef|=0.685
        bm25_entropy                        |coef|=0.643
    B=8000: n=117 solvable tasks
      Majority vote: embedding (54.7%)
      Router B (smart):  64.1%  gap=+20.8%
      Router B (safest): 62.4%  gap=+17.0%
      Random:            41.8%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bm25_entropy                        |coef|=1.220
        bm25_top1_score                     |coef|=0.915
        bca_no_closure_budget_util          |coef|=0.910
        entity_count_mapped                 |coef|=0.846
        bca_no_scoring_budget_util          |coef|=0.846
        vector_top1_score                   |coef|=0.791
        vector_entropy                      |coef|=0.789
    B=10000: n=119 solvable tasks
      Majority vote: embedding (62.2%)
      Router B (smart):  62.2%  gap=+0.0%
      Router B (safest): 59.7%  gap=-6.7%
      Random:            45.3%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        vector_top1_score                   |coef|=0.977
        graph_node_count_log                |coef|=0.893
        bm25_top1_score                     |coef|=0.865
        bm25_entropy                        |coef|=0.817
        bca_budget_util                     |coef|=0.712
        entity_count_mapped                 |coef|=0.697
        query_identifier_density            |coef|=0.661

  [EXACT queries]
    B=2000: n=234 solvable tasks
      Majority vote: embedding (79.5%)
      Router B (smart):  78.6%  gap=-4.2%
      Router B (safest): 79.1%  gap=-2.1%
      Random:            63.9%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        vector_top1_score                   |coef|=0.990
        query_identifier_density            |coef|=0.914
        graph_node_count_log                |coef|=0.869
        bca_no_scoring_top1_score           |coef|=0.739
        bca_no_scoring_budget_util          |coef|=0.718
        vector_entropy                      |coef|=0.717
        vector_budget_util                  |coef|=0.673
    B=4000: n=234 solvable tasks
      Majority vote: embedding (80.3%)
      Router B (smart):  79.9%  gap=-2.2%
      Router B (safest): 80.8%  gap=+2.2%
      Random:            70.1%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_d5_budget_util                  |coef|=1.049
        graph_node_count_log                |coef|=0.932
        bm25_top1_score                     |coef|=0.928
        bm25_entropy                        |coef|=0.759
        entity_count_mapped                 |coef|=0.751
        vector_budget_util                  |coef|=0.720
        bca_budget_util                     |coef|=0.703
    B=8000: n=235 solvable tasks
      Majority vote: vector (79.6%)
      Router B (smart):  79.1%  gap=-2.1%
      Router B (safest): 79.6%  gap=+0.0%
      Random:            73.9%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_d1_budget_util                  |coef|=0.934
        bca_no_scoring_top1_score           |coef|=0.827
        vector_top1_score                   |coef|=0.809
        bm25_budget_util                    |coef|=0.804
        bca_no_scoring_budget_util          |coef|=0.700
        embedding_top1_score                |coef|=0.683
        graph_node_count_log                |coef|=0.663
    B=10000: n=238 solvable tasks
      Majority vote: embedding (82.4%)
      Router B (smart):  80.7%  gap=-9.5%
      Router B (safest): 82.4%  gap=+0.0%
      Random:            74.9%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_no_closure_entropy              |coef|=0.871
        bca_no_scoring_top1_score           |coef|=0.864
        bca_d1_entropy                      |coef|=0.821
        bm25_top1_score                     |coef|=0.800
        bca_no_scoring_entropy              |coef|=0.778
        bm25_budget_util                    |coef|=0.670
        bm25_entropy                        |coef|=0.614

  [VAGUE queries]
    B=2000: n=34 solvable tasks
      Majority vote: embedding (67.6%)
      Router B (smart):  58.8%  gap=-27.3%
      Router B (safest): 61.8%  gap=-18.2%
      Random:            29.1%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        vector_entropy                      |coef|=0.825
        vector_budget_util                  |coef|=0.778
        bca_no_scoring_top1_score           |coef|=0.732
        vector_top1_score                   |coef|=0.705
        bca_no_scoring_budget_util          |coef|=0.636
        graph_node_count_log                |coef|=0.597
        bm25_top1_score                     |coef|=0.580
    B=4000: n=30 solvable tasks
      Majority vote: embedding (73.3%)
      Router B (smart):  76.7%  gap=+12.5%
      Router B (safest): 83.3%  gap=+37.5%
      Random:            24.8%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        vector_top1_score                   |coef|=0.789
        vector_budget_util                  |coef|=0.551
        bca_d1_budget_util                  |coef|=0.481
        entity_count_mapped                 |coef|=0.440
        bca_d5_budget_util                  |coef|=0.412
        query_identifier_density            |coef|=0.398
        bca_d1_top1_score                   |coef|=0.389
    B=8000: n=30 solvable tasks
      Majority vote: embedding (73.3%)
      Router B (smart):  70.0%  gap=-12.5%
      Router B (safest): 73.3%  gap=+0.0%
      Random:            24.8%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_d1_entropy                      |coef|=0.810
        bca_d1_budget_util                  |coef|=0.749
        vector_entropy                      |coef|=0.487
        vector_top1_score                   |coef|=0.487
        query_identifier_density            |coef|=0.449
        bca_no_scoring_top1_score           |coef|=0.434
        bm25_top1_score                     |coef|=0.425
    B=10000: n=28 solvable tasks
      Majority vote: embedding (71.4%)
      Router B (smart):  71.4%  gap=+0.0%
      Router B (safest): 75.0%  gap=+12.5%
      Random:            26.6%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_entropy                         |coef|=0.674
        bca_d1_entropy                      |coef|=0.597
        vector_top1_score                   |coef|=0.566
        embedding_top1_score                |coef|=0.516
        bca_no_scoring_top1_score           |coef|=0.404
        vector_entropy                      |coef|=0.390
        query_identifier_density            |coef|=0.381


==========================================================================================
Router Comparison: A vs B vs Majority-Vote vs Random vs Oracle
  Router A candidates: 10 methods (incl. no_retrieval)
  Router B candidates: 9 retrieval methods (excl. no_retrieval)
==========================================================================================

  [DEV_REPORT queries]
  Budget       Maj(A)   Rnd(A)     RtrA   Orc(A)   N(A)   Maj(B)   Rnd(B)     RtrB   Orc(B)   N(B)
  --------------------------------------------------------------------------------------------------
  B=2000       57.1%    33.5%    59.2%   100.0%     98    57.7%    36.9%    69.1%   100.0%     97
  B=4000       55.2%    35.3%    59.0%   100.0%    105    55.2%    38.6%    58.1%   100.0%    105
  B=8000       54.7%    38.1%    53.8%   100.0%    117    54.7%    41.8%    64.1%   100.0%    117
  B=10000      62.2%    41.3%    66.4%   100.0%    119    62.2%    45.3%    62.2%   100.0%    119

  NOTE: A and B use different candidate sets, so solvable-task pools may differ.
  Compare RouterA against A baselines (Maj/Rnd/Orc A), and RouterB against B baselines.

  [EXACT queries]
  Budget       Maj(A)   Rnd(A)     RtrA   Orc(A)   N(A)   Maj(B)   Rnd(B)     RtrB   Orc(B)   N(B)
  --------------------------------------------------------------------------------------------------
  B=2000       88.7%    65.4%    88.2%   100.0%    238    79.5%    63.9%    78.6%   100.0%    234
  B=4000       88.3%    70.6%    88.3%   100.0%    239    80.3%    70.1%    79.9%   100.0%    234
  B=8000       88.7%    74.5%    88.7%   100.0%    238    79.6%    73.9%    79.1%   100.0%    235
  B=10000      87.9%    75.6%    87.9%   100.0%    240    82.4%    74.9%    80.7%   100.0%    238

  NOTE: A and B use different candidate sets, so solvable-task pools may differ.
  Compare RouterA against A baselines (Maj/Rnd/Orc A), and RouterB against B baselines.

  [VAGUE queries]
  Budget       Maj(A)   Rnd(A)     RtrA   Orc(A)   N(A)   Maj(B)   Rnd(B)     RtrB   Orc(B)   N(B)
  --------------------------------------------------------------------------------------------------
  B=2000       67.6%    26.2%    64.7%   100.0%     34    67.6%    29.1%    58.8%   100.0%     34
  B=4000       73.3%    22.3%    70.0%   100.0%     30    73.3%    24.8%    76.7%   100.0%     30
  B=8000       73.3%    22.3%    73.3%   100.0%     30    73.3%    24.8%    70.0%   100.0%     30
  B=10000      71.4%    23.9%    71.4%   100.0%     28    71.4%    26.6%    71.4%   100.0%     28

  NOTE: A and B use different candidate sets, so solvable-task pools may differ.
  Compare RouterA against A baselines (Maj/Rnd/Orc A), and RouterB against B baselines.