# src/cegraph/context/models.py:15-15
    SMART = "balanced"  # Graph-expanded with relevance scoring (default)

# paper/experiments/baselines.py:28-28
from cegraph.context.models import ContextStrategy, TokenEstimator

# paper/experiments/ablation.py:21-21
from cegraph.context.models import ContextStrategy

# paper/experiments/benchmark.py:55-55
from cegraph.context.models import ContextStrategy, TokenEstimator

# src/cegraph/context/__init__.py:15-15
from cegraph.context.models import ContextPackage, ContextItem, ContextStrategy

# src/cegraph/context/engine.py:43-48
from cegraph.context.models import (
    ContextItem,
    ContextPackage,
    ContextStrategy,
    TokenEstimator,
)

# tests/test_context.py:10-15
from cegraph.context.models import (
    ContextItem,
    ContextPackage,
    ContextStrategy,
    TokenEstimator,
)

# src/cegraph/context/engine.py:90-109
_STRATEGY_CONFIG = {
    ContextStrategy.PRECISE: {
        "max_depth": 1,
        "min_score": 0.3,
        "include_callers": True,
        "include_callees": True,
    },
    ContextStrategy.SMART: {
        "max_depth": 3,
        "min_score": 0.1,
        "include_callers": True,
        "include_callees": True,
    },
    ContextStrategy.THOROUGH: {
        "max_depth": 5,
        "min_score": 0.05,
        "include_callers": True,
        "include_callees": True,
    },
}

# src/cegraph/context/models.py:11-16
class ContextStrategy(str, Enum):
    """Strategy for assembling context."""

    PRECISE = "precise"  # Only directly relevant symbols
    SMART = "balanced"  # Graph-expanded with relevance scoring (default)
    THOROUGH = "thorough"  # Deep expansion, all related code

# tests/test_context.py:48-52
class TestContextStrategy:
    def test_strategies_exist(self):
        assert ContextStrategy.PRECISE.value == "precise"
        assert ContextStrategy.SMART.value == "smart"
        assert ContextStrategy.THOROUGH.value == "thorough"

# src/cegraph/context/models.py:14-14
    PRECISE = "precise"  # Only directly relevant symbols

# src/cegraph/context/models.py:16-16
    THOROUGH = "thorough"  # Deep expansion, all related code

# tests/test_context.py:49-52
    def test_strategies_exist(self):
        assert ContextStrategy.PRECISE.value == "precise"
        assert ContextStrategy.SMART.value == "smart"
        assert ContextStrategy.THOROUGH.value == "thorough"

# tests/test_context.py:208-221
    def test_strategies_differ(self, cag_engine: ContextAssembler):
        """Test that different strategies produce different results."""
        precise = cag_engine.assemble(
            task="fix the main function",
            token_budget=8000,
            strategy=ContextStrategy.PRECISE,
        )
        thorough = cag_engine.assemble(
            task="fix the main function",
            token_budget=8000,
            strategy=ContextStrategy.THOROUGH,
        )
        # Thorough should generally find more candidates
        assert thorough.symbols_available >= precise.symbols_available

# tests/test_config.py:60-63
    def test_set_config_invalid_key(self):
        config = ProjectConfig()
        with pytest.raises(KeyError):
            set_config_value(config, "nonexistent.key", "value")

# tests/test_impact_bot.py:9-15
from cegraph.github.diff_parser import (
    DiffHunk,
    FileDiff,
    ChangedSymbol,
    get_changed_symbols,
    parse_diff,
)

# src/cegraph/github/impact_bot.py:26-33
from cegraph.github.diff_parser import (
    ChangedSymbol,
    FileDiff,
    get_changed_symbols,
    get_git_diff,
    get_pr_diff,
    parse_diff,
)

# src/cegraph/github/renderer.py:15-15
from cegraph.github.diff_parser import ChangedSymbol

# tests/test_impact_bot.py:113-142
class TestChangedSymbols:
    def test_get_changed_symbols(self, tmp_project: Path):
        builder = GraphBuilder()
        graph = builder.build_from_directory(tmp_project)

        # Create a diff that modifies utils.py around helper_function
        file_diff = FileDiff(
            path="utils.py",
            status="modified",
            hunks=[DiffHunk(old_start=5, old_count=3, new_start=5, new_count=3)],
        )

        changed = get_changed_symbols(tmp_project, graph, [file_diff])
        # Should find symbols that overlap with lines 5-8 in utils.py
        # helper_function is defined around that area
        if changed:
            assert all(isinstance(s, ChangedSymbol) for s in changed)
            names = [s.name for s in changed]
            assert any("helper" in n for n in names)

    def test_deleted_file_symbols(self, tmp_project: Path):
        builder = GraphBuilder()
        graph = builder.build_from_directory(tmp_project)

        file_diff = FileDiff(path="utils.py", status="deleted")
        changed = get_changed_symbols(tmp_project, graph, [file_diff])
        # All symbols in utils.py should be marked as deleted
        for s in changed:
            assert s.change_type == "deleted"
            assert s.file_path == "utils.py"

# src/cegraph/ui/console.py:9-9
from rich.syntax import Syntax

# src/cegraph/parser/models.py:18-18
    CONSTANT = "constant"

# tests/test_context.py:302-305
    def test_is_not_accelerated(self, cag_engine: ContextAssembler):
        """Test that C++ acceleration is reported correctly."""
        # In tests, C++ extension is typically not compiled
        assert isinstance(cag_engine.is_accelerated, bool)

# src/cegraph/parser/tree_sitter_parser.py:26-61
_SYMBOL_NODE_TYPES = {
    "javascript": {
        "function_declaration": SymbolKind.FUNCTION,
        "class_declaration": SymbolKind.CLASS,
        "method_definition": SymbolKind.METHOD,
        "arrow_function": SymbolKind.FUNCTION,
        "lexical_declaration": None,
    },
    "typescript": {
        "function_declaration": SymbolKind.FUNCTION,
        "class_declaration": SymbolKind.CLASS,
        "method_definition": SymbolKind.METHOD,
        "interface_declaration": SymbolKind.INTERFACE,
        "type_alias_declaration": SymbolKind.TYPE_ALIAS,
        "enum_declaration": SymbolKind.ENUM,
        "arrow_function": SymbolKind.FUNCTION,
    },
    "go": {
        "function_declaration": SymbolKind.FUNCTION,
        "method_declaration": SymbolKind.METHOD,
        "type_declaration": SymbolKind.CLASS,
    },
    "rust": {
        "function_item": SymbolKind.FUNCTION,
        "struct_item": SymbolKind.CLASS,
        "enum_item": SymbolKind.ENUM,
        "trait_item": SymbolKind.INTERFACE,
        "impl_item": SymbolKind.CLASS,
    },
    "java": {
        "class_declaration": SymbolKind.CLASS,
        "interface_declaration": SymbolKind.INTERFACE,
        "method_declaration": SymbolKind.METHOD,
        "enum_declaration": SymbolKind.ENUM,
    },
}

# tests/test_parser.py:31-36
    def test_unknown(self):
        assert detect_language("readme.md") is None
        assert detect_language("data.json") is None
        # Languages without tree-sitter grammars are not supported
        assert detect_language("main.rb") is None
        assert detect_language("main.php") is None

# tests/test_mcp.py:189-218
class TestMCPMessageHandling:
    def test_handle_notification(self, mcp_server: MCPServer):
        """Test notification handling (no response)."""
        result = mcp_server._handle_message({
            "jsonrpc": "2.0",
            "method": "notifications/initialized",
        })
        assert result is None  # Notifications don't get responses

    def test_handle_request(self, mcp_server: MCPServer):
        """Test request handling (has id, gets response)."""
        result = mcp_server._handle_message({
            "jsonrpc": "2.0",
            "id": 1,
            "method": "ping",
            "params": {},
        })
        assert result is not None
        assert result["jsonrpc"] == "2.0"
        assert result["id"] == 1

    def test_handle_unknown_method(self, mcp_server: MCPServer):
        """Test error handling for unknown methods."""
        result = mcp_server._handle_message({
            "jsonrpc": "2.0",
            "id": 1,
            "method": "unknown/method",
            "params": {},
        })
        assert "error" in result

# tests/test_mcp.py:210-218
    def test_handle_unknown_method(self, mcp_server: MCPServer):
        """Test error handling for unknown methods."""
        result = mcp_server._handle_message({
            "jsonrpc": "2.0",
            "id": 1,
            "method": "unknown/method",
            "params": {},
        })
        assert "error" in result

# src/cegraph/github/diff_parser.py:47-56
class ChangedSymbol:
    """A symbol that was affected by the diff."""
    name: str
    qualified_name: str
    kind: str
    file_path: str
    line_start: int
    line_end: int
    change_type: str  # 'modified', 'added', 'deleted'
    lines_changed: int = 0

# tests/test_config.py:50-53
    def test_set_config_value(self):
        config = ProjectConfig()
        updated = set_config_value(config, "llm.provider", "openai")
        assert updated.llm.provider == "openai"

# tests/test_context.py:178-186
    def test_assemble_with_specific_symbol(self, cag_engine: ContextAssembler):
        """Test context assembly with a specific symbol name."""
        package = cag_engine.assemble(
            task="refactor the calculate_total function",
            token_budget=8000,
        )
        # Should find calculate_total and related symbols
        symbol_names = [item.name for item in package.items]
        assert "calculate_total" in symbol_names

# tests/test_context.py:198-206
    def test_assemble_respects_budget(self, cag_engine: ContextAssembler):
        """Test that assembly respects the token budget."""
        small_budget = 100
        package = cag_engine.assemble(
            task="review the entire codebase",
            token_budget=small_budget,
            strategy=ContextStrategy.THOROUGH,
        )
        assert package.total_tokens <= small_budget * 1.5  # Allow small overshoot

# src/cegraph/config.py:41-46
class AgentConfig(BaseModel):
    """Agent behavior configuration."""

    max_iterations: int = 15
    auto_verify: bool = True
    require_approval: bool = True

# tests/test_mcp.py:170-186
class TestMCPSecurity:
    def test_resources_read_path_traversal(self, mcp_server: MCPServer):
        """Regression: reading files outside the project root must be denied."""
        result = mcp_server._dispatch("resources/read", {
            "uri": "file://../../../../etc/hosts",
        })
        text = result["contents"][0].get("text", "")
        assert "Access denied" in text
        assert "localhost" not in text

    def test_resources_read_valid_file(self, mcp_server: MCPServer):
        """Reading a file inside the project root should work."""
        result = mcp_server._dispatch("resources/read", {
            "uri": "file://main.py",
        })
        text = result["contents"][0].get("text", "")
        assert "Access denied" not in text

# tests/test_parser.py:154-167
class TestCoreParser:
    def test_auto_detect_python(self, sample_python_source: str):
        result = parse_file("sample.py", sample_python_source)
        assert result is not None
        assert result.language == "python"

    def test_auto_detect_javascript(self, sample_js_source: str):
        result = parse_file("app.js", sample_js_source)
        assert result is not None
        assert result.language == "javascript"

    def test_unsupported_file(self):
        result = parse_file("readme.md", "# Hello")
        assert result is None

# tests/test_impact_bot.py:16-16
from cegraph.github.renderer import render_impact_comment, _risk_badge, _render_file_tree

# tests/test_cli.py:55-60
    def test_search_symbol(self, runner: CliRunner, indexed_project: Path):
        result = runner.invoke(
            main, ["search", "User", "--path", str(indexed_project)]
        )
        assert result.exit_code == 0
        assert "User" in result.output

# src/cegraph/parser/models.py:17-17
    VARIABLE = "variable"

# paper/experiments/baselines.py:27-27
from cegraph.context.engine import ContextAssembler

# paper/experiments/ablation.py:20-20
from cegraph.context.engine import AblationConfig, ContextAssembler

# src/cegraph/context/__init__.py:14-14
from cegraph.context.engine import ContextAssembler

# tests/test_context.py:9-9
from cegraph.context.engine import ContextAssembler

# paper/experiments/benchmark.py:54-54
from cegraph.context.engine import AblationConfig, ContextAssembler

# tests/test_context.py:257-263
    def test_extract_entities_snake_case(self, cag_engine: ContextAssembler):
        """Test snake_case entity extraction."""
        entities = cag_engine._extract_entities(
            "refactor the calculate_total function"
        )
        names = [e["name"] for e in entities]
        assert "calculate_total" in names

# src/cegraph/parser/models.py:34-34
    OVERRIDES = "overrides"

# tests/test_mcp.py:93-101
    def test_search_code(self, mcp_server: MCPServer):
        """Test the search_code tool."""
        result = mcp_server._dispatch("tools/call", {
            "name": "search_code",
            "arguments": {"query": "main"},
        })
        assert not result.get("isError")
        content = result["content"][0]["text"]
        assert "main" in content

# src/cegraph/context/models.py:163-163
    CHARS_PER_TOKEN = 4.0

# tests/test_parser.py:160-163
    def test_auto_detect_javascript(self, sample_js_source: str):
        result = parse_file("app.js", sample_js_source)
        assert result is not None
        assert result.language == "javascript"

# tests/test_search.py:69-84
class TestHybridSearch:
    def test_search_delegates_to_lexical(self, tmp_project: Path):
        builder = GraphBuilder()
        graph = builder.build_from_directory(tmp_project)
        search = HybridSearch(tmp_project, graph)

        results = search.search("calculate_total")
        assert len(results) > 0

    def test_search_symbols(self, tmp_project: Path):
        builder = GraphBuilder()
        graph = builder.build_from_directory(tmp_project)
        search = HybridSearch(tmp_project, graph)

        results = search.search_symbols("Order")
        assert len(results) > 0

# src/cegraph/ui/console.py:13-13
from cegraph.agent.loop import AgentStep

# tests/test_impact_bot.py:55-66
SAMPLE_DIFF_DELETED = """\
diff --git a/old_module.py b/old_module.py
deleted file mode 100644
index abc1234..0000000
--- a/old_module.py
+++ /dev/null
@@ -1,3 +0,0 @@
-\"\"\"Old module.\"\"\"
-
-def obsolete():
-    pass
"""

# tests/test_cli.py:54-67
class TestCLISearch:
    def test_search_symbol(self, runner: CliRunner, indexed_project: Path):
        result = runner.invoke(
            main, ["search", "User", "--path", str(indexed_project)]
        )
        assert result.exit_code == 0
        assert "User" in result.output

    def test_search_no_results(self, runner: CliRunner, indexed_project: Path):
        result = runner.invoke(
            main, ["search", "xyznonexistent", "--path", str(indexed_project)]
        )
        assert result.exit_code == 0
        assert "No" in result.output

# tests/test_parser.py:112-114
    def test_syntax_error_handling(self):
        result = parse_python_file("bad.py", "def broken(:\n  pass")
        assert len(result.errors) > 0

# tests/test_parser.py:165-167
    def test_unsupported_file(self):
        result = parse_file("readme.md", "# Hello")
        assert result is None

# src/cegraph/cli.py:730-766
def config_cmd(action: str, key: str | None, value: str | None, path: str | None):
    """Manage CeGraph configuration."""
    root = _get_project_root(path)
    config = load_config(root)

    if action == "show":
        console.console.print_json(json.dumps(config.model_dump(), indent=2))
    elif action == "get":
        if not key:
            console.error("Usage: cegraph config get <key>")
            sys.exit(1)
        data = config.model_dump()
        parts = key.split(".")
        for part in parts:
            if isinstance(data, dict) and part in data:
                data = data[part]
            else:
                console.error(f"Unknown key: {key}")
                sys.exit(1)
        console.console.print(f"{key} = {data}")
    elif action == "set":
        if not key or value is None:
            console.error("Usage: cegraph config set <key> <value>")
            sys.exit(1)
        try:
            # Try to parse as JSON for non-string values
            try:
                parsed_value = json.loads(value)
            except json.JSONDecodeError:
                parsed_value = value

            config = set_config_value(config, key, parsed_value)
            save_config(root, config)
            console.success(f"Set {key} = {parsed_value}")
        except KeyError:
            console.error(f"Unknown config key: {key}")
            sys.exit(1)

# tests/test_impact_bot.py:146-148
    def test_risk_badge_low(self):
        emoji, label, color = _risk_badge(0.05)
        assert label == "LOW"

# src/cegraph/exceptions.py:24-25
class ToolError(CeGraphError):
    """Agent tool execution errors."""