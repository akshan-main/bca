# paper/experiments/baselines.py:29-29
from cegraph.graph.builder import GraphBuilder

# src/cegraph/graph/__init__.py:3-3
from cegraph.graph.builder import GraphBuilder

# tests/test_graph.py:10-10
from cegraph.graph.builder import GraphBuilder

# tests/test_impact_bot.py:17-17
from cegraph.graph.builder import GraphBuilder

# tests/test_search.py:9-9
from cegraph.graph.builder import GraphBuilder

# tests/test_context.py:16-16
from cegraph.graph.builder import GraphBuilder

# tests/test_tools.py:9-9
from cegraph.graph.builder import GraphBuilder

# paper/experiments/benchmark.py:56-56
from cegraph.graph.builder import GraphBuilder

# examples/demo.py:9-9
from cegraph.graph.builder import GraphBuilder

# tests/test_mcp.py:10-10
from cegraph.graph.builder import GraphBuilder

# paper/experiments/ablation.py:22-22
from cegraph.graph.builder import GraphBuilder

# tests/test_graph.py:77-98
    def test_rebuild_resets_state(self, tmp_path: Path):
        """Regression: reusing a builder must not accumulate stale nodes."""
        # First project
        p1 = tmp_path / "proj1"
        p1.mkdir()
        (p1 / "a.py").write_text("def a_func():\n    pass\n")

        builder = GraphBuilder()
        g1 = builder.build_from_directory(p1)
        g1_files = {d["path"] for _, d in g1.nodes(data=True) if d.get("type") == "file"}

        # Second project with different files
        p2 = tmp_path / "proj2"
        p2.mkdir()
        (p2 / "b.py").write_text("def b_func():\n    pass\n")

        g2 = builder.build_from_directory(p2)
        g2_files = {d["path"] for _, d in g2.nodes(data=True) if d.get("type") == "file"}

        # g2 should NOT contain files from g1
        assert "a.py" not in g2_files
        assert "b.py" in g2_files

# src/cegraph/context/engine.py:171-193
    def _build_native_graph(self) -> None:
        """Build the C++ graph representation for accelerated BFS."""
        nodes = list(self.graph.nodes())
        self._node_to_idx = {n: i for i, n in enumerate(nodes)}
        self._idx_to_node = {i: n for i, n in enumerate(nodes)}

        self._native_graph = NativeCAG.create_graph(len(nodes))

        for n, data in self.graph.nodes(data=True):
            idx = self._node_to_idx[n]
            kind = data.get("kind", "")
            weight = _KIND_WEIGHTS.get(kind, 0.5)
            self._native_graph.set_node_weight(idx, weight)
            self._native_graph.set_lines(
                idx, data.get("line_start", 0), data.get("line_end", 0)
            )

        for u, v, data in self.graph.edges(data=True):
            kind = data.get("kind", "")
            weight = self._edge_weights.get(kind, 0.3)
            src = self._node_to_idx[u]
            dst = self._node_to_idx[v]
            self._native_graph.add_edge(src, dst, weight)

# tests/test_graph.py:76-98
class TestGraphBuilderReuse:
    def test_rebuild_resets_state(self, tmp_path: Path):
        """Regression: reusing a builder must not accumulate stale nodes."""
        # First project
        p1 = tmp_path / "proj1"
        p1.mkdir()
        (p1 / "a.py").write_text("def a_func():\n    pass\n")

        builder = GraphBuilder()
        g1 = builder.build_from_directory(p1)
        g1_files = {d["path"] for _, d in g1.nodes(data=True) if d.get("type") == "file"}

        # Second project with different files
        p2 = tmp_path / "proj2"
        p2.mkdir()
        (p2 / "b.py").write_text("def b_func():\n    pass\n")

        g2 = builder.build_from_directory(p2)
        g2_files = {d["path"] for _, d in g2.nodes(data=True) if d.get("type") == "file"}

        # g2 should NOT contain files from g1
        assert "a.py" not in g2_files
        assert "b.py" in g2_files

# src/cegraph/graph/query.py:44-54
    def _build_index(self) -> None:
        """Build a name->node_id lookup index."""
        for node_id, data in self.graph.nodes(data=True):
            if data.get("type") != "symbol":
                continue
            name = data.get("name", "")
            qname = data.get("qualified_name", "")
            if name:
                self._name_index.setdefault(name, []).append(node_id)
            if qname and qname != name:
                self._name_index.setdefault(qname, []).append(node_id)

# src/cegraph/graph/builder.py:25-28
    def __init__(self) -> None:
        self.graph = nx.DiGraph()
        self._file_hashes: dict[str, str] = {}
        self._unresolved: list[Relationship] = []

# src/cegraph/graph/__init__.py:4-4
from cegraph.graph.store import GraphStore

# src/cegraph/graph/query.py:9-9
from cegraph.graph.store import GraphStore

# tests/test_graph.py:12-12
from cegraph.graph.store import GraphStore

# tests/test_mcp.py:12-12
from cegraph.graph.store import GraphStore

# src/cegraph/exceptions.py:16-17
class GraphError(CeGraphError):
    """Knowledge graph errors."""