# Codebase Context for: Default LLM provider is set to openai instead of anthropic, breaking configurations that rely on the anthropic default.
# 15 symbols from 12 files (~1,022 tokens, 102% of budget)

## src/cegraph/cli.py
# Included because: graph expansion (depth 3)

# [function] _load_graph (relevance: 0.39, depth: 3)
  47 | def _load_graph(root: Path):
  48 |     """Load the knowledge graph and related objects."""
  49 |     from cegraph.graph.store import GraphStore
  50 | 
  51 |     db_path = get_cegraph_dir(root) / GRAPH_DB_FILE
  52 |     store = GraphStore(db_path)
  53 |     graph = store.load()
  54 |     if graph is None:
  55 |         console.error("No index found. Run 'cegraph init' or 'cegraph reindex' first.")
  56 |         sys.exit(1)
  57 |     return graph, store

## src/cegraph/config.py
# Included because: matches 'set'

# [function] set_config_value (relevance: 0.40, depth: 0)
 125 | def set_config_value(config: ProjectConfig, key: str, value: Any) -> ProjectConfig:
 126 |     """Set a nested config value using dot notation (e.g., 'llm.provider')."""
 127 |     parts = key.split(".")
 128 |     data = config.model_dump()
 129 |     target = data
 130 |     for part in parts[:-1]:
 131 |         if part not in target or not isinstance(target[part], dict):
 132 |             raise KeyError(f"Invalid config key: {key}")
 133 |         target = target[part]
 134 |     if parts[-1] not in target:
 135 |         raise KeyError(f"Invalid config key: {key}")
 136 |     target[parts[-1]] = value
 137 |     return ProjectConfig(**data)

## src/cegraph/context/models.py
# Included because: graph expansion (depth 2)

# [method] TokenEstimator.estimate_lines (relevance: 0.27, depth: 2)
 171 |     def estimate_lines(cls, line_count: int, avg_line_length: int = 40) -> int:
 172 |         """Estimate tokens for a given number of lines."""
 173 |         return max(1, int(line_count * avg_line_length / cls.CHARS_PER_TOKEN))

## src/cegraph/exceptions.py
# Included because: graph expansion (depth 2); graph expansion (depth 3)

# [class] LLMError (relevance: 0.20, depth: 3)
  20 | class LLMError(CeGraphError):
  21 |     """LLM provider errors."""

# [class] ProviderNotAvailable (relevance: 0.25, depth: 2)
  32 | class ProviderNotAvailable(LLMError):
  33 |     """Raised when an LLM provider's SDK is not installed."""
  34 | 
  35 |     def __init__(self, provider: str, package: str):
  36 |         super().__init__(
  37 |             f"Provider '{provider}' requires the '{package}' package. "
  38 |             f"Install it with: pip install cegraph[{provider}]"
  39 |         )

## src/cegraph/github/diff_parser.py
# Included because: graph expansion (depth 2)

# [function] get_pr_diff (relevance: 0.21, depth: 2)
 205 | def get_pr_diff(root: Path) -> str:
 206 |     """Get the diff for the current PR (GitHub Actions context)."""
 207 |     import os
 208 |     base_ref = os.environ.get("GITHUB_BASE_REF", "main")
 209 |     return get_git_diff(root, base=f"origin/{base_ref}")

## src/cegraph/graph/query.py
# Included because: graph expansion (depth 2)

# [method] GraphQuery.find_symbol (relevance: 0.40, depth: 2)
  56 |     def find_symbol(self, name: str) -> list[str]:
  57 |         """Find symbol node IDs matching a name (exact or qualified)."""
  58 |         results = self._name_index.get(name, [])
  59 |         if not results:
  60 |             # Try partial match
  61 |             for key, ids in self._name_index.items():
  62 |                 if name.lower() in key.lower():
  63 |                     results.extend(ids)
  64 |         return list(set(results))

## src/cegraph/llm/anthropic_provider.py
# Included because: graph expansion (depth 1)

# [method] AnthropicProvider.__init__ (relevance: 0.29, depth: 1)
  20 |     def __init__(
  21 |         self,
  22 |         model: str = "claude-sonnet-4-5-20250929",
  23 |         api_key: str | None = None,
  24 |         base_url: str | None = None,
  25 |     ) -> None:
  26 |         super().__init__(model, api_key, base_url)
  27 |         self._client = None

# [method] AnthropicProvider._format_tools (relevance: 0.31, depth: 1)
  86 |     def _format_tools(self, tools: list[ToolDefinition]) -> list[dict]:
  87 |         """Convert tool definitions to Anthropic's format."""
  88 |         return [
  89 |             {
  90 |                 "name": tool.name,
  91 |                 "description": tool.description,
  92 |                 "input_schema": tool.parameters,
  93 |             }
  94 |             for tool in tools
  95 |         ]

## src/cegraph/llm/openai_provider.py
# Included because: graph expansion (depth 1)

# [method] OpenAIProvider.__init__ (relevance: 0.29, depth: 1)
  20 |     def __init__(
  21 |         self, model: str = "gpt-4o", api_key: str | None = None, base_url: str | None = None
  22 |     ) -> None:
  23 |         super().__init__(model, api_key, base_url)
  24 |         self._client = None
  25 |         self._async_client = None

## src/cegraph/mcp/server.py
# Included because: graph expansion (depth 2)

# [method] MCPServer._handle_notification (relevance: 0.21, depth: 2)
 424 |     def _handle_notification(self, method: str, params: dict) -> None:
 425 |         """Handle a notification (no response needed)."""
 426 |         if method == "notifications/initialized":
 427 |             logger.info("Client initialized")
 428 |         elif method == "notifications/cancelled":
 429 |             logger.info(f"Request cancelled: {params.get('requestId')}")

## src/cegraph/parser/models.py
# Included because: graph expansion (depth 2)

# [function] detect_language (relevance: 0.19, depth: 2)
 100 | def detect_language(file_path: str) -> str | None:
 101 |     """Detect programming language from file extension."""
 102 |     from pathlib import Path
 103 | 
 104 |     ext = Path(file_path).suffix.lower()
 105 |     return EXTENSION_LANGUAGE_MAP.get(ext)

## src/cegraph/parser/tree_sitter_parser.py
# Included because: graph expansion (depth 3)

# [function] _extract_ts_import (relevance: 0.15, depth: 3)
 250 | def _extract_ts_import(node, file_path: str, source: bytes, result: FileSymbols) -> None:
 251 |     """Extract import information from a tree-sitter node."""
 252 |     text = node.text.decode("utf-8")
 253 |     result.imports.append(text)

## src/cegraph/tools/registry.py
# Included because: graph expansion (depth 2); graph expansion (depth 1)

# [method] ToolRegistry.get (relevance: 0.51, depth: 1)
  26 |     def get(self, name: str) -> Callable | None:
  27 |         """Get a tool function by name."""
  28 |         return self._tools.get(name)

# [method] ToolRegistry.get_definition (relevance: 0.17, depth: 2)
  30 |     def get_definition(self, name: str) -> ToolDefinition | None:
  31 |         """Get a tool definition by name."""
  32 |         return self._definitions.get(name)
