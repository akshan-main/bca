```
FILE: cegraph/graph/query.py
SEARCH:
    def who_calls(self, function_name: str, max_depth: int = 1) -> list[dict]:
        """Find who calls a given function up to a certain depth."""
        callers = []
        for node in self.graph.nodes:
            if node.kind == "function" and node.name == function_name:
                callers.extend(self._find_callers(node, max_depth))
        return callers
REPLACE:
    def who_calls(self, function_name: str, max_depth: int = 1) -> list[dict]:
        """Find who calls a given function up to a certain depth."""
        callers = []
        for node in self.graph.nodes:
            if node.kind == "function" and node.name == function_name:
                callers.extend(self._find_callers(node, max_depth, relationship_type="call"))
        return callers
```

```
FILE: cegraph/graph/query.py
SEARCH:
    def _find_callers(self, node, max_depth, current_depth=0) -> list[dict]:
        """Recursively find callers of a node."""
        if current_depth >= max_depth:
            return []

        callers = []
        for edge in self.graph.edges:
            if edge.target == node.id and edge.kind == "containment":
                caller_node = self.graph.get_node(edge.source)
                callers.append({
                    "name": caller_node.name,
                    "file_path": caller_node.file_path,
                    "line": caller_node.line_start,
                    "depth": current_depth
                })
                callers.extend(self._find_callers(caller_node, max_depth, current_depth + 1))
        return callers
REPLACE:
    def _find_callers(self, node, max_depth, current_depth=0, relationship_type="containment") -> list[dict]:
        """Recursively find callers of a node."""
        if current_depth >= max_depth:
            return []

        callers = []
        for edge in self.graph.edges:
            if edge.target == node.id and edge.kind == relationship_type:
                caller_node = self.graph.get_node(edge.source)
                callers.append({
                    "name": caller_node.name,
                    "file_path": caller_node.file_path,
                    "line": caller_node.line_start,
                    "depth": current_depth
                })
                callers.extend(self._find_callers(caller_node, max_depth, current_depth + 1, relationship_type))
        return callers
```