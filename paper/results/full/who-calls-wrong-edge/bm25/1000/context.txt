# tests/test_graph.py:170-175
    def test_who_calls(self, tmp_project: Path):
        query = self._build_query(tmp_project)
        callers = query.who_calls("helper_function")
        # main() calls helper_function()
        caller_names = [c["name"] for c in callers]
        assert any("main" in name for name in caller_names)

# tests/test_cli.py:71-75
    def test_who_calls(self, runner: CliRunner, indexed_project: Path):
        result = runner.invoke(
            main, ["who-calls", "helper_function", "--path", str(indexed_project)]
        )
        assert result.exit_code == 0

# src/cegraph/cli.py:202-218
def who_calls(symbol_name: str, path: str | None, depth: int):
    """Find all callers of a function or method."""
    root = _get_project_root(path)
    graph, store = _load_graph(root)

    from cegraph.graph.query import GraphQuery

    query = GraphQuery(graph, store)
    callers = query.who_calls(symbol_name, max_depth=depth)

    if callers:
        console.info(f"Callers of '{symbol_name}':")
        console.show_callers(callers, symbol_name)
    else:
        console.warning(f"No callers found for '{symbol_name}'")

    store.close()

# tests/test_mcp.py:103-109
    def test_who_calls(self, mcp_server: MCPServer):
        """Test the who_calls tool."""
        result = mcp_server._dispatch("tools/call", {
            "name": "who_calls",
            "arguments": {"symbol": "helper_function"},
        })
        assert not result.get("isError")

# src/cegraph/mcp/server.py:269-281
    def _tool_who_calls(self, args: dict) -> str:
        self._ensure_graph()
        callers = self._query.who_calls(
            args["symbol"], max_depth=args.get("max_depth", 3)
        )
        if not callers:
            return f"No callers found for '{args['symbol']}'"

        lines = [f"Callers of '{args['symbol']}':"]
        for c in callers:
            indent = "  " * c.get("depth", 1)
            lines.append(f"{indent}{c['name']} ({c['kind']}) at {c['file_path']}:{c['line']}")
        return "\n".join(lines)

# src/cegraph/tools/definitions.py:77-89
    def who_calls(self, symbol_name: str, max_depth: int = 2) -> str:
        """Find all callers of a function/method."""
        results = self.query.who_calls(symbol_name, max_depth=max_depth)
        if not results:
            return f"No callers found for '{symbol_name}'"

        output = [f"Callers of `{symbol_name}`:"]
        for r in results:
            indent = "  " * r["depth"]
            output.append(
                f"{indent}â† **{r['name']}** ({r['kind']}) at {r['file_path']}:{r['line']}"
            )
        return "\n".join(output)

# tests/test_cli.py:77-82
    def test_who_calls_not_found(self, runner: CliRunner, indexed_project: Path):
        result = runner.invoke(
            main, ["who-calls", "nonexistent_func", "--path", str(indexed_project)]
        )
        assert result.exit_code == 0
        assert "No callers" in result.output

# tests/test_tools.py:35-38
    def test_who_calls(self, tmp_project: Path):
        tools = self._build_tools(tmp_project)
        result = tools.who_calls("helper_function")
        assert "main" in result.lower() or "Callers" in result

# tests/test_cli.py:70-82
class TestCLIWhoCalls:
    def test_who_calls(self, runner: CliRunner, indexed_project: Path):
        result = runner.invoke(
            main, ["who-calls", "helper_function", "--path", str(indexed_project)]
        )
        assert result.exit_code == 0

    def test_who_calls_not_found(self, runner: CliRunner, indexed_project: Path):
        result = runner.invoke(
            main, ["who-calls", "nonexistent_func", "--path", str(indexed_project)]
        )
        assert result.exit_code == 0
        assert "No callers" in result.output

# tests/test_graph.py:177-182
    def test_what_calls(self, tmp_project: Path):
        query = self._build_query(tmp_project)
        callees = query.what_calls("main")
        callee_names = [c["name"] for c in callees]
        # main() should call several functions
        assert len(callees) > 0

# src/cegraph/parser/models.py:28-28
    CALLS = "calls"

# src/cegraph/llm/base.py:55-56
    def has_tool_calls(self) -> bool:
        return len(self.tool_calls) > 0

# tests/test_tools.py:40-43
    def test_what_calls(self, tmp_project: Path):
        tools = self._build_tools(tmp_project)
        result = tools.what_calls("main")
        assert len(result) > 0

# src/cegraph/agent/loop.py:14-14
from typing import Any, AsyncIterator, Callable

# src/cegraph/agent/loop.py:17-17
from cegraph.llm.base import LLMProvider, LLMResponse, Message, ToolCall, ToolResult

# src/cegraph/agent/loop.py:17-17
from cegraph.llm.base import LLMProvider, LLMResponse, Message, ToolCall, ToolResult