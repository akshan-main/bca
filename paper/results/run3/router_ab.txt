
==========================================================================================
Feature Validity Audit
  (Which features can each router legitimately use in a real deployment?)
==========================================================================================

  Router A (pre-retrieval, choose-first):
    VALID:
      entity_count_extracted      — parsed from query text
      entity_count_mapped         — looked up in graph (cheap, local)
      query_identifier_density    — computed from query text
      graph_node_count            — repo-level constant (known at init)
      budget                      — given by user/system

    INVALID (not available before retrieval):
      retrieval_*                 — requires running a retrieval method
      tokens_used, symbols_selected, files_included — assembly output
      assembly_time_ms            — assembly output
      bca_*                       — BCA-specific assembly output

    INVALID (leakage — requires knowing mutation location):
      mutation_symbol_lines       — size of mutated function
      mutation_file_symbols       — symbols in mutated file
      target_file_hit             — requires knowing target file
      target_symbol_hit           — requires knowing target symbol
      min_hops_seed_to_mutation   — requires knowing mutation
      median_hops_seed_to_mutation
      edit_distance_lines         — post-hoc evaluation metric

  Router B (dry-run retrieval, then choose):
    VALID (all Router A features PLUS per-method):
      retrieval_top1_score        — confidence of top retrieval result
      retrieval_budget_utilization — fraction of budget used
      retrieval_softmax_entropy   — score distribution spread
      retrieval_effective_candidates — number of competitive candidates
      retrieval_top1_top2_gap     — gap between #1 and #2 scores
      tokens_used                 — context size produced
      symbols_selected            — number of symbols selected
      files_included              — number of files in context
      bca_frontier_visited        — BCA traversal breadth
      bca_closure_added_*         — BCA closure overhead

      NOTE: These are per-method. Router B has one value per candidate method.

    STILL INVALID (leakage):
      target_file_hit, target_symbol_hit, mutation_*, min_hops_*,
      edit_distance_*, tests_passed, failure_mode, patch, test_output



==========================================================================================
Router A: Choose-First (Pre-Retrieval Features Only)
  Decision based on query + repo features BEFORE running any retrieval.
  Features: entity_count_mapped, query_identifier_density, graph_node_count_log
  Candidates: bca, bca_d1, bca_d5, bca_no_closure, bca_no_scoring, bm25, no_retrieval, repo_map, vector
  Evaluation: LOO-CV, success = predicted method is in passing set
  Two strategies: 'smart' (default→deviate) and 'safest' (always safest)
==========================================================================================

  [EXACT queries]
    B=2000: n=238 solvable tasks
      Majority vote: no_retrieval (88.7%)
      Router A (smart):  88.2%  gap=-3.7%
      Router A (safest): 88.7%  gap=+0.0%
      Random:            64.0%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=1.693
        query_identifier_density            |coef|=0.990
        graph_node_count_log                |coef|=0.559
    B=4000: n=239 solvable tasks
      Majority vote: no_retrieval (88.3%)
      Router A (smart):  88.3%  gap=+0.0%
      Router A (safest): 88.3%  gap=+0.0%
      Random:            69.7%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=1.379
        graph_node_count_log                |coef|=0.566
        query_identifier_density            |coef|=0.481
    B=8000: n=238 solvable tasks
      Majority vote: no_retrieval (88.7%)
      Router A (smart):  88.7%  gap=+0.0%
      Router A (safest): 88.7%  gap=+0.0%
      Random:            74.1%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=0.971
        graph_node_count_log                |coef|=0.672
        query_identifier_density            |coef|=0.651
    B=10000: n=239 solvable tasks
      Majority vote: no_retrieval (88.3%)
      Router A (smart):  88.3%  gap=+0.0%
      Router A (safest): 88.3%  gap=+0.0%
      Random:            75.3%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=1.375
        graph_node_count_log                |coef|=0.619
        query_identifier_density            |coef|=0.448

  [VAGUE queries]
    B=2000: n=20 solvable tasks
      Majority vote: bm25 (80.0%)
      Router A (smart):  75.0%  gap=-25.0%
      Router A (safest): 75.0%  gap=-25.0%
      Random:            36.7%
      Oracle:            100.0%
      Top features (smart):
        query_identifier_density            |coef|=0.680
        entity_count_mapped                 |coef|=0.571
        graph_node_count_log                |coef|=0.545
    B=4000: n=17 solvable tasks
      Majority vote: bm25 (70.6%)
      Router A (smart):  64.7%  gap=-20.0%
      Router A (safest): 64.7%  gap=-20.0%
      Random:            29.4%
      Oracle:            100.0%
      Top features (smart):
        graph_node_count_log                |coef|=0.960
        entity_count_mapped                 |coef|=0.928
        query_identifier_density            |coef|=0.684
    B=8000: n=16 solvable tasks
      Majority vote: bm25 (68.8%)
      Router A (smart):  68.8%  gap=+0.0%
      Router A (safest): 68.8%  gap=+0.0%
      Random:            31.2%
      Oracle:            100.0%
      Top features (smart):
        entity_count_mapped                 |coef|=0.864
        graph_node_count_log                |coef|=0.725
        query_identifier_density            |coef|=0.381
    B=10000: n=15 solvable tasks
      Majority vote: bm25 (86.7%)
      Router A (smart):  80.0%  gap=-50.0%
      Router A (safest): 80.0%  gap=-50.0%
      Random:            34.8%
      Oracle:            100.0%
      Top features (smart):
        query_identifier_density            |coef|=0.364
        graph_node_count_log                |coef|=0.306
        entity_count_mapped                 |coef|=0.074


==========================================================================================
Router B: Dry-Run Then Choose (Retrieval Confidence Features)
  Runs all retrieval methods locally (no LLM call), examines their
  confidence metrics, picks the best method, then calls LLM once.
  Features: Router A + per-method {top1_score, budget_util, entropy}
  Total features: 27 (3 query + 8 methods x 3 metrics)
  Candidates: bca, bca_d1, bca_d5, bca_no_closure, bca_no_scoring, bm25, repo_map, vector
==========================================================================================

  [EXACT queries]
    B=2000: n=233 solvable tasks
      Majority vote: vector (78.1%)
      Router B (smart):  78.1%  gap=+0.0%
      Router B (safest): 78.1%  gap=+0.0%
      Random:            62.2%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_d1_entropy                      |coef|=1.057
        graph_node_count_log                |coef|=1.042
        query_identifier_density            |coef|=0.850
        bm25_top1_score                     |coef|=0.818
        entity_count_mapped                 |coef|=0.791
        bca_no_scoring_entropy              |coef|=0.694
        bca_budget_util                     |coef|=0.681
    B=4000: n=231 solvable tasks
      Majority vote: vector (78.8%)
      Router B (smart):  78.8%  gap=+0.0%
      Router B (safest): 79.2%  gap=+2.0%
      Random:            69.7%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bm25_entropy                        |coef|=1.010
        bca_d1_budget_util                  |coef|=0.972
        vector_entropy                      |coef|=0.895
        bca_no_scoring_budget_util          |coef|=0.839
        graph_node_count_log                |coef|=0.731
        bca_budget_util                     |coef|=0.724
        bca_d5_entropy                      |coef|=0.719
    B=8000: n=234 solvable tasks
      Majority vote: vector (79.9%)
      Router B (smart):  79.9%  gap=+0.0%
      Router B (safest): 79.9%  gap=+0.0%
      Random:            73.5%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_d1_budget_util                  |coef|=0.874
        vector_top1_score                   |coef|=0.774
        bca_no_scoring_top1_score           |coef|=0.758
        bm25_budget_util                    |coef|=0.727
        entity_count_mapped                 |coef|=0.708
        query_identifier_density            |coef|=0.681
        bca_no_scoring_budget_util          |coef|=0.671
    B=10000: n=235 solvable tasks
      Majority vote: vector (82.6%)
      Router B (smart):  82.6%  gap=+0.0%
      Router B (safest): 82.1%  gap=-2.4%
      Random:            74.9%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_d1_budget_util                  |coef|=1.140
        bca_no_scoring_top1_score           |coef|=1.091
        bm25_budget_util                    |coef|=0.948
        graph_node_count_log                |coef|=0.906
        bm25_top1_score                     |coef|=0.794
        query_identifier_density            |coef|=0.738
        bca_d5_entropy                      |coef|=0.646

  [VAGUE queries]
    B=2000: n=20 solvable tasks
      Majority vote: bm25 (80.0%)
      Router B (smart):  75.0%  gap=-25.0%
      Router B (safest): 75.0%  gap=-25.0%
      Random:            41.2%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        vector_budget_util                  |coef|=0.634
        vector_entropy                      |coef|=0.555
        bm25_entropy                        |coef|=0.477
        bca_no_scoring_budget_util          |coef|=0.397
        entity_count_mapped                 |coef|=0.360
        query_identifier_density            |coef|=0.360
        vector_top1_score                   |coef|=0.349
    B=4000: n=17 solvable tasks
      Majority vote: bm25 (70.6%)
      Router B (smart):  76.5%  gap=+20.0%
      Router B (safest): 76.5%  gap=+20.0%
      Random:            33.1%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        entity_count_mapped                 |coef|=0.630
        bm25_entropy                        |coef|=0.556
        vector_entropy                      |coef|=0.509
        vector_top1_score                   |coef|=0.491
        graph_node_count_log                |coef|=0.383
        vector_budget_util                  |coef|=0.345
        bca_d5_budget_util                  |coef|=0.332
    B=8000: n=16 solvable tasks
      Majority vote: bm25 (68.8%)
      Router B (smart):  68.8%  gap=+0.0%
      Router B (safest): 75.0%  gap=+20.0%
      Random:            35.2%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        vector_budget_util                  |coef|=0.894
        bm25_entropy                        |coef|=0.596
        vector_entropy                      |coef|=0.422
        bca_no_closure_budget_util          |coef|=0.413
        bca_d1_budget_util                  |coef|=0.401
        vector_top1_score                   |coef|=0.348
        graph_node_count_log                |coef|=0.289
    B=10000: n=15 solvable tasks
      Majority vote: bm25 (86.7%)
      Router B (smart):  73.3%  gap=-100.0%
      Router B (safest): 73.3%  gap=-100.0%
      Random:            39.2%
      Oracle:            100.0%
      Top features (smart, by max |coef|):
        bca_d1_entropy                      |coef|=0.437
        vector_top1_score                   |coef|=0.406
        bca_d5_entropy                      |coef|=0.363
        bca_no_closure_budget_util          |coef|=0.358
        bca_budget_util                     |coef|=0.358
        bca_no_scoring_entropy              |coef|=0.319
        vector_entropy                      |coef|=0.302


==========================================================================================
Router Comparison: A vs B vs Majority-Vote vs Random vs Oracle
  Router A candidates: 9 methods (incl. no_retrieval)
  Router B candidates: 8 retrieval methods (excl. no_retrieval)
==========================================================================================

  [EXACT queries]
  Budget       Maj(A)   Rnd(A)     RtrA   Orc(A)   N(A)   Maj(B)   Rnd(B)     RtrB   Orc(B)   N(B)
  --------------------------------------------------------------------------------------------------
  B=2000       88.7%    64.0%    88.2%   100.0%    238    78.1%    62.2%    78.1%   100.0%    233
  B=4000       88.3%    69.7%    88.3%   100.0%    239    78.8%    69.7%    78.8%   100.0%    231
  B=8000       88.7%    74.1%    88.7%   100.0%    238    79.9%    73.5%    79.9%   100.0%    234
  B=10000      88.3%    75.3%    88.3%   100.0%    239    82.6%    74.9%    82.6%   100.0%    235

  NOTE: A and B use different candidate sets, so solvable-task pools may differ.
  Compare RouterA against A baselines (Maj/Rnd/Orc A), and RouterB against B baselines.

  [VAGUE queries]
  Budget       Maj(A)   Rnd(A)     RtrA   Orc(A)   N(A)   Maj(B)   Rnd(B)     RtrB   Orc(B)   N(B)
  --------------------------------------------------------------------------------------------------
  B=2000       80.0%    36.7%    75.0%   100.0%     20    80.0%    41.2%    75.0%   100.0%     20
  B=4000       70.6%    29.4%    64.7%   100.0%     17    70.6%    33.1%    76.5%   100.0%     17
  B=8000       68.8%    31.2%    68.8%   100.0%     16    68.8%    35.2%    68.8%   100.0%     16
  B=10000      86.7%    34.8%    80.0%   100.0%     15    86.7%    39.2%    73.3%   100.0%     15

  NOTE: A and B use different candidate sets, so solvable-task pools may differ.
  Compare RouterA against A baselines (Maj/Rnd/Orc A), and RouterB against B baselines.