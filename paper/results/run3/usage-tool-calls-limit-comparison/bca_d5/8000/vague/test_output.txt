_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = UsageLimits(tool_calls_limit=0)
projected_usage = RunUsage(input_tokens=51, output_tokens=5, requests=1, tool_calls=-1)

    def check_before_tool_call(self, projected_usage: RunUsage) -> None:
        """Raises a `UsageLimitExceeded` exception if the next tool call(s) would exceed the tool call limit."""
        tool_calls_limit = self.tool_calls_limit
        tool_calls = projected_usage.tool_calls
        if tool_calls_limit is not None and tool_calls < tool_calls_limit:
>           raise UsageLimitExceeded(
                f'The next tool call(s) would exceed the tool_calls_limit of {tool_calls_limit} ({tool_calls=}).'
            )
E           pydantic_ai.exceptions.UsageLimitExceeded: The next tool call(s) would exceed the tool_calls_limit of 0 (tool_calls=-1).

pydantic_ai_slim/pydantic_ai/usage.py:405: UsageLimitExceeded

During handling of the above exception, another exception occurred:

    async def test_tool_call_limit() -> None:
        test_agent = Agent(TestModel())
    
        @test_agent.tool_plain
        async def ret_a(x: str) -> str:
            return f'{x}-apple'
    
>       with pytest.raises(
            UsageLimitExceeded,
            match=re.escape('The next tool call(s) would exceed the tool_calls_limit of 0 (tool_calls=1).'),
        ):
E       AssertionError: Regex pattern did not match.
E        Regex: 'The\\ next\\ tool\\ call\\(s\\)\\ would\\ exceed\\ the\\ tool_calls_limit\\ of\\ 0\\ \\(tool_calls=1\\)\\.'
E        Input: 'The next tool call(s) would exceed the tool_calls_limit of 0 (tool_calls=-1).'

tests/test_usage_limits.py:294: AssertionError
=========================== short test summary info ============================
FAILED tests/test_usage_limits.py::test_tool_call_limit - AssertionError: Reg...
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============================== 1 failed in 0.58s ===============================

/Users/akshankrithick/anaconda3/envs/vvenv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:247: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))