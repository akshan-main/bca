transformer = TestTransformer(original_schema)
>       result = transformer.walk()

tests/test_json_schema.py:83: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
pydantic_ai_slim/pydantic_ai/_json_schema.py:62: in walk
    handled = self._handle(schema)
pydantic_ai_slim/pydantic_ai/_json_schema.py:106: in _handle
    schema = self._handle_object(schema)
pydantic_ai_slim/pydantic_ai/_json_schema.py:132: in _handle_object
    schema['additionalProperties'] = self._handle(additional_properties)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = test_schema_defs_not_modified.<locals>.TestTransformer(), schema = None

    def _handle(self, schema: JsonSchema) -> JsonSchema:
        nested_refs = 0
        if self.prefer_inlined_defs:
            while ref := schema.get('$ref'):
                key = re.sub(r'^#/\$defs/', '', ref)
                if key in self.recursive_refs:
                    break
                if key in self.refs_stack:
                    self.recursive_refs.add(key)
                    break  # recursive ref can't be unpacked
                self.refs_stack.append(key)
                nested_refs += 1
    
                def_schema = self.defs.get(key)
                if def_schema is None:  # pragma: no cover
                    raise UserError(f'Could not find $ref definition for {key}')
                schema = def_schema
    
        # Handle the schema based on its type / structure
>       type_ = schema.get('type')
E       AttributeError: 'NoneType' object has no attribute 'get'

pydantic_ai_slim/pydantic_ai/_json_schema.py:104: AttributeError
=========================== short test summary info ============================
FAILED tests/test_json_schema.py::test_schema_defs_not_modified - AttributeEr...
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
========================= 1 failed, 1 passed in 0.55s ==========================

/Users/akshankrithick/anaconda3/envs/vvenv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:247: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))