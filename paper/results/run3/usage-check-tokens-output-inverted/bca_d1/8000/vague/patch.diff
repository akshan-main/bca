FILE: pydantic_ai_slim/pydantic_ai/agent/abstract.py
SEARCH:
        if not isinstance(next_node, _agent_graph.AgentNode):
REPLACE:
        if not isinstance(next_node, _agent_graph.AgentNode) or (self.output_tokens_limit is not None and len(node.output_tokens) >= self.output_tokens_limit):

FILE: pydantic_ai_slim/pydantic_ai/agent/__init__.py
SEARCH:
        output_toolset: AbstractToolset[AgentDepsT] | None | _utils.Unset = _utils.UNSET,
REPLACE:
        output_toolset: AbstractToolset[AgentDepsT] | None | _utils.Unset = _utils.UNSET,
        output_tokens_limit: int | None = None,

FILE: pydantic_ai_slim/pydantic_ai/agent/__init__.py
SEARCH:
        return toolset
REPLACE:
        if output_tokens_limit is not None:
            toolset.output_tokens_limit = output_tokens_limit
        return toolset
