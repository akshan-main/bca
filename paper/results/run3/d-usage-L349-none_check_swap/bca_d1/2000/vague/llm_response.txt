```
FILE: pydantic_ai_slim/pydantic_ai/models/__init__.py
SEARCH:
        if params.output_tools and params.output_mode != 'tool':
            params = replace(params, output_tools=[])
REPLACE:
        if params.output_tools and params.output_mode != 'tool' and self._settings is not None:
            params = replace(params, output_tools=[])
```

```
FILE: pydantic_ai_slim/pydantic_ai/models/__init__.py
SEARCH:
        if params.output_object and params.output_mode not in ('native', 'prompted'):
            params = replace(params, output_object=None)
REPLACE:
        if params.output_object and params.output_mode not in ('native', 'prompted') and self._settings is not None:
            params = replace(params, output_object=None)
```

```
FILE: pydantic_ai_slim/pydantic_ai/models/__init__.py
SEARCH:
        if params.prompted_output_template and params.output_mode not in ('prompted', 'native'):
            params = replace(params, prompted_output_template=None)  # pragma: no cover
REPLACE:
        if params.prompted_output_template and params.output_mode not in ('prompted', 'native') and self._settings is not None:
            params = replace(params, prompted_output_template=None)  # pragma: no cover
```