```
FILE: pydantic_ai_slim/pydantic_ai/agent/abstract.py
SEARCH:
        if infer_name and self.name is None:
            self._infer_name(inspect.currentframe())
REPLACE:
        if infer_name and self.name is None and not self._is_name_inferred:
            self._infer_name(inspect.currentframe())
```
```
FILE: pydantic_ai_slim/pydantic_ai/agent/abstract.py
SEARCH:
        async def _consume_stream():
REPLACE:
        async def _consume_stream(infer_name: bool):
```
```
FILE: pydantic_ai_slim/pydantic_ai/agent/abstract.py
SEARCH:
                yield stream_result
REPLACE:
                yield stream_result, infer_name
```
```
FILE: pydantic_ai_slim/pydantic_ai/agent/abstract.py
SEARCH:
        async_result = _utils.get_event_loop().run_until_complete(anext(_consume_stream()))
REPLACE:
        async_result, _is_name_inferred = _utils.get_event_loop().run_until_complete(anext(_consume_stream(infer_name)))
```