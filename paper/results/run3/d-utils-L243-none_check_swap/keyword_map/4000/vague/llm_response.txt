```
FILE: pydantic_ai_slim/pydantic_ai/agent/__init__.py
SEARCH:
        if model is None or defer_model_check:
REPLACE:
        if model is None and not defer_model_check:
```

```
FILE: pydantic_ai_slim/pydantic_ai/_parts_manager.py
SEARCH:
        if vendor_part_id is None:
REPLACE:
        if vendor_part_id is None and tool_name is None:
```

```
FILE: pydantic_ai_slim/pydantic_ai/models/instrumented.py
SEARCH:
            if not (tokens := getattr(response.usage, f'{typ}_tokens', 0)):  # pragma: no cover
REPLACE:
            if tokens is None or tokens == 0:  # pragma: no cover
```