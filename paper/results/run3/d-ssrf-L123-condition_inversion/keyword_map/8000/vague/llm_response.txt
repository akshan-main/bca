```
FILE: pydantic_ai_slim/pydantic_ai/agent/abstract.py
SEARCH:
        if isinstance(deps, StateHandler):  # pragma: no branch
            deps = replace(deps)
REPLACE:
        if not isinstance(deps, StateHandler):  # pragma: no branch
            deps = replace(deps)
```

```
FILE: pydantic_ai_slim/pydantic_ai/agent/abstract.py
SEARCH:
        if infer_name and self.name is None:
            # f_back because `asynccontextmanager` adds one frame
            if frame := inspect.currentframe():  # pragma: no branch
                self._infer_name(frame.f_back)
REPLACE:
        if not infer_name or self.name is not None:
            # f_back because `asynccontextmanager` adds one frame
            if frame := inspect.currentframe():  # pragma: no branch
                self._infer_name(frame.f_back)
```