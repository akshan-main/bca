cio-1.3.0, rich-0.2.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 1 item

tests/test_usage_limits.py F

=================================== FAILURES ===================================
____________________________ test_total_token_limit ____________________________

    def test_total_token_limit() -> None:
        test_agent = Agent(TestModel(custom_output_text='This utilizes 4 tokens!'))
    
        with pytest.raises(UsageLimitExceeded, match=re.escape('Exceeded the total_tokens_limit of 50 (total_tokens=55)')):
>           test_agent.run_sync('Hello', usage_limits=UsageLimits(total_tokens_limit=50))

tests/test_usage_limits.py:63: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
pydantic_ai_slim/pydantic_ai/agent/abstract.py:386: in run_sync
    return _utils.get_event_loop().run_until_complete(
../../anaconda3/envs/vvenv/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
pydantic_ai_slim/pydantic_ai/agent/abstract.py:259: in run
    async with self.iter(
../../anaconda3/envs/vvenv/lib/python3.11/contextlib.py:210: in __aenter__
    return await anext(self.gen)
pydantic_ai_slim/pydantic_ai/agent/__init__.py:640: in iter
    usage = usage or _usage.RunUsage()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'RunUsage' object has no attribute 'details'") raised in repr()] RunUsage object at 0x107355850>

>   ???
E   AttributeError: property 'total_tokens' of 'RunUsage' object has no setter

<string>:10: AttributeError
=========================== short test summary info ============================
FAILED tests/test_usage_limits.py::test_total_token_limit - AttributeError: p...
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============================== 1 failed in 0.46s ===============================

/Users/akshankrithick/anaconda3/envs/vvenv/lib/python3.11/site-packages/pytest_asyncio/plugin.py:247: PytestDeprecationWarning: The configuration option "asyncio_default_fixture_loop_scope" is unset.
The event loop scope for asynchronous fixtures will default to the fixture caching scope. Future versions of pytest-asyncio will default the loop scope for asynchronous fixtures to function scope. Set the default fixture loop scope explicitly in order to avoid unexpected behavior in the future. Valid fixture loop scopes are: "function", "class", "module", "package", "session"

  warnings.warn(PytestDeprecationWarning(_DEFAULT_FIXTURE_LOOP_SCOPE_UNSET))